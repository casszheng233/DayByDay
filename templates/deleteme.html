<script>
$(document).ready(function() {

{% extends "base_task.html" %}

{% block customize %}

  function defineMonth(){
    var date = new Date();
    var firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
    var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
    console.log(firstDay);
    console.log(lastDay);
    var weeks = [firstDay];

    for (i = 1; i < 6; i++){
      d = new Date(firstDay.getTime() + 86400000*i);
      weeks.push(d);
    }
    return weeks;
  }

  monthWeeks = defineMonth();

  //the week we define goes from last Sunday to Saturday
  //todo: daylights saving safe version
  function defineWeek(dateObj){
    var sunday = dateObj;
    sunday.setDate(sunday.getDate() - sunday.getDay());

    dStr = sunday.toLocaledisplayNamestring().split('/');
    week = [dStr[2] + ',' + dStr[0] + ',' + dStr[1]];

    //add rest of week
    for (i = 1; i < 7; i++){
      d = new Date(sunday.getTime() + 86400000*i); //robust against end-of-month changes
      dStr = d.toLocaledisplayNamestring().split('/');
      week.push(dStr[2] + ',' + dStr[0] + ',' + dStr[1] );
    }
    return week;
  }

  //create table to seperate days of week and contain tasks
  $("#container2").append('<table style="width:100%; border-style: solid;" id = "weekTasks" ></table>')
  $("#weekTasks").append('<tr id = headers>   </tr>');

  //put days of week into headers
  // displaynames = formatWeekNames();
  var weeknames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  for (i = 0; i < 7; i++){
    var header = '<th>' + weeknames[i] + '</th>';
    $("#headers").append(header);
  }

  //formats week names for display in header
  function formatWeekNames(date){
    var week = defineWeek(date);
    var weeknames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]; //consider making current day name bold
    var displaynames = [];

    for (i = 0; i < 7; i++){
      var date = week[i].split(',');
      displaynames.push(date[1] + "/" + date[2]);
      // displaynames.push(weeknames[i]);
    }
    return displaynames
  }


  function oneWeek(day){
    var displayNames = formatWeekNames(day);
    $("#weekTasks").append('<tr> <td id = ' + displayNames[0].replace("/","_") + ' > ' + displayNames[0] + ' </td>' +
                                '<td id = ' + displayNames[1].replace("/","_") + ' > ' + displayNames[1] + ' </td>' +
                                '<td id = ' + displayNames[2].replace("/","_") + ' > ' + displayNames[2] + ' </td>' +
                                '<td id = ' + displayNames[3].replace("/","_") + ' > ' + displayNames[3] + ' </td>' +
                                '<td id = ' + displayNames[4].replace("/","_") + ' > ' + displayNames[4] + ' </td>' +
                                '<td id = ' + displayNames[5].replace("/","_") + ' > ' + displayNames[5] + ' </td>' +
                                '<td id = ' + displayNames[6].replace("/","_") + ' > ' + displayNames[6] + ' </td>' +  '</tr>');

  }

  oneWeek(monthWeeks[0]);

  //creates row of table into which tasks will be placed
  // var week = defineWeek(new Date());
  // var displayNames = formatWeekNames(new Date());
  // $("#weekTasks").append('<tr> <td id = ' + displayNames[0].replace("/","_") + ' > ' + displayNames[0] + ' </td>' +
  //                             '<td id = ' + displayNames[1].replace("/","_") + ' > ' + displayNames[1] + ' </td>' +
  //                             '<td id = ' + displayNames[2].replace("/","_") + ' > ' + displayNames[2] + ' </td>' +
  //                             '<td id = ' + displayNames[3].replace("/","_") + ' > ' + displayNames[3] + ' </td>' +
  //                             '<td id = ' + displayNames[4].replace("/","_") + ' > ' + displayNames[4] + ' </td>' +
  //                             '<td id = ' + displayNames[5].replace("/","_") + ' > ' + displayNames[5] + ' </td>' +
  //                             '<td id = ' + displayNames[6].replace("/","_") + ' > ' + displayNames[6] + ' </td>' +  '</tr>');

  //for one task from the data structure, if the date on task matches a date to be displayed,
  //create the task in the corresponding slot of the week table
  function placeSubtasksHelper (j, dataStruct, date, selector){

    //makes sure task's due date is the same as the relevant date
    function placer(taskDic, isParent, selector){
      if (taskDic["end"].toString() == date){
        buildTask(taskDic["taskID"], taskDic["catColor"], taskDic["cat"], taskDic["name"], taskDic["isFinished"].toString(), isParent, selector, "week");
      }
    }

    taskDic = dataStruct[j][0];
    placer(taskDic, true, selector);
    for (i=0; i < dataStruct[j][1].length; i++){
        taskDic = dataStruct[j][1][i];
        placer(taskDic,false, selector);
      }
  }

  //iterate through all tasks and place them in the relevant week
  function placeSubtasks(dataStruct){
    var week = defineWeek(new Date());

    //iterate through all tasks
    for (j=0; j < dataStruct.length; j++ ){

      placeSubtasksHelper(j, dataStruct, week[0], week[0].split(',')[2]);
      placeSubtasksHelper(j, dataStruct, week[1], week[1].split(',')[2]);
      placeSubtasksHelper(j, dataStruct, week[2], week[2].split(',')[2]);
      placeSubtasksHelper(j, dataStruct, week[3], week[3].split(',')[2]);
      placeSubtasksHelper(j, dataStruct, week[4], week[4].split(',')[2]);
      placeSubtasksHelper(j, dataStruct, week[5], week[5].split(',')[2]);
      placeSubtasksHelper(j, dataStruct, week[6], week[6].split(',')[2]);

    }
  }

  // placeSubtasks(dataStruct);


});
</script>

{% endblock %}
