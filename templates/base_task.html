{% extends "base.html" %}

{% block rightPanel %}
<script>
$(document).ready(function() {

  // get which categories user has checked in order to select
  // certain categories of task for display
  catChoice = (Cookies.get('catChoice'));
  var catChoiceObj = "";
  if (catChoice){
    catChoiceObj = JSON.parse(catChoice);
  }
  catChoiceDic = {};
  for (i = 0; i < catChoiceObj.length; i ++){
    catChoiceDic[catChoiceObj[i][0].toString()] = catChoiceObj[i][1];
  }

  //find today
  var today = new Date(),
      d = today.getDate(),
      m = today.getMonth()+1,
      y = today.getFullYear();
  var date = y + "," + m + "," + d;
  $('#headerright').append("Today is: " + y + "-" + m + "-" + d);

  //recieve the data structure containing task information from sql database
  var data = "{{ dataStruct }}";
  var data = data.replace(/&#39;/g,"\"");
  var dataStruct = JSON.parse(data);

  // TODO: toggling on completely done tasks
  // IN PROGRESS: determining if all of a task's subtasks have been ticked
  for (i = 0; i < dataStruct.length; i++){
      var subtasks = dataStruct[i][1];
      if (Object.keys(subtasks[0]).length != 0){
      let allDone = subtasks.reduce((result,taskDic) =>
          {return (taskDic['isFinished'] && (result))  }, true);
      // console.log("foldr: " + allDone);
    }
  }


  // build html for, and place into 'selector' one task
  function buildTask(taskID, catColor, category, name, isFin, isParent, selector, timeChoice){
    // unless 'catall' has been ticked,
    if (!catChoiceDic["catall"]){
      // halt processing a task if that task's category was not ticked
      if (!catChoiceDic["cat" + category]){
       return;
      }
    }

    //determines whether checkbox should be rendered pre-checked
    finBool = "";
    if (parseInt(isFin)){
      finBool = " checked ";
    }

    //determines whether name of task should be rendered bold, indicating it is a parent
    nameParent = name;
    if (isParent){
      nameParent = "<b>" + name + "</b>";
    }
    nameParent = "<font color=" + catColor +  ">" + nameParent + "</font>";

    //building each form.
    $('#' + selector).append('<form method=POST action="{{ url_for("tickTask") }}">   <div class=task id=task' + taskID + ' >   </div></form>');

    // styling of panel
    var line0 = '<div class="panel panel-default" style="width:95%; margin: 10px 2% 0 1%; border-width: 1px !important; border-style: solid !important; border-color:#'+ catColor +' !important;" > <div class="panel-body"><div class="pretty p-svg p-curve">';

    //form items: hidden form values for backend processing, and the checkbox
    var line1 = "<input type='hidden' value='"+ timeChoice +"_checklist' name='timeSelector'>";
    var line2 = "<input type='hidden' value='task"+ taskID +"' name='taskCheck'>";
    var line3 = "<input type='checkbox'"+ finBool +" onchange='this.form.submit();' name='taskCheck' value='task"+ taskID +"'/> ";

    //styling of checkbox icon
    var colorDict = {'418ACA':'p-primary', '5DB85B':'p-success', 'F0AD4E':'p-warning', '5BC0DE':'p-info', 'D9534E':'p-danger'}
    var line4 = '<div class="state '+ colorDict[catColor] +'"><svg class="svg svg-icon" viewBox="0 0 20 20"><path d="M7.629,14.566c0.125,0.125,0.291,0.188,0.456,0.188c0.164,0,0.329-0.062,0.456-0.188l8.219-8.221c0.252-0.252,0.252-0.659,0-0.911c-0.252-0.252-0.659-0.252-0.911,0l-7.764,7.763L4.152,9.267c-0.252-0.251-0.66-0.251-0.911,0c-0.252,0.252-0.252,0.66,0,0.911L7.629,14.566z" style="stroke: white;fill:white;"></path></svg>';

    //passing of nameParent label and closing of all divs
    var line5 = '<label>'+ nameParent +'</label>';
    var line6 = '</div></div></div></div>';

    $("#task" + taskID.toString()).append(line0 + line1 + line2 + line3 + line4 + line5 + line6);
  }

{% endblock %}

// base_task_day, week, and month inherit this file and add code in this block
{% block customize %}
{% endblock %}
